/*
 * This file is auto-generated by Chargebee.
 * For more information on how to make changes to this file, please see the README.
 * Reach out to dx@chargebee.com for any questions.
 * Copyright 2025 Chargebee Inc.
 */

package com.chargebee.v4.services;

import com.chargebee.v4.services.BaseService;
import com.chargebee.v4.services.ServiceConfig;
import com.chargebee.v4.client.ChargebeeClient;
import com.chargebee.v4.client.request.RequestOptions;
import com.chargebee.v4.exceptions.ChargebeeException;
import com.chargebee.v4.transport.Response;
import java.util.Map;
import java.util.List;
{{#each operations}}
import com.chargebee.v4.models.{{../packageName}}.params.{{paramsClassName}};
{{/each}}
{{#each operations}}
import com.chargebee.v4.models.{{../packageName}}.responses.{{returnType}};
{{/each}}


public final class {{name}}Service extends BaseService<{{name}}Service> {
    
    private final ServiceConfig config;
    
    public {{name}}Service(ChargebeeClient client) {
        super(client);
        this.config = ServiceConfig.defaultConfig();
    }
    
    private {{name}}Service(ChargebeeClient client, RequestOptions options) {
        super(client, options);
        this.config = ServiceConfig.defaultConfig();
    }
    
    private {{name}}Service(ChargebeeClient client, RequestOptions options, ServiceConfig config) {
        super(client, options);
        this.config = config;
    }
    
    @Override
    {{name}}Service with(RequestOptions newOptions) {
        return new {{name}}Service(client, newOptions, config);
    }
    
    /**
     * Apply per-request options for this service instance.
     * Users can chain .withOptions or .options to set headers and other options.
     */
    public {{name}}Service withOptions(RequestOptions options) {
        return with(options);
    }
    
    // === Operations ===
    {{#each operations}}
    {{#if hasPathParams}}
    {{#if isListResponse}}
    
    /**
     * {{methodName}} a {{../packageName}} using immutable params (executes immediately) - returns raw Response.
     */
    Response {{methodName}}Raw(String {{pathParamName}}, {{paramsClassName}} params) throws ChargebeeException {
        String path = buildPathWithParams("{{path}}", "{{pathParam}}", {{pathParamName}});
        return get(path, params != null ? params.toQueryParams() : null);
    }

    /**
     * {{methodName}} a {{../packageName}} without params (executes immediately) - returns raw Response.
     */
    Response {{methodName}}Raw(String {{pathParamName}}) throws ChargebeeException {
        String path = buildPathWithParams("{{path}}", "{{pathParam}}", {{pathParamName}});
        return get(path, null);
    }

    /**
     * {{methodName}} a {{../packageName}} using raw JSON payload (executes immediately) - returns raw Response.
     */
    Response {{methodName}}Raw(String {{pathParamName}}, String jsonPayload) throws ChargebeeException {
        String path = buildPathWithParams("{{path}}", "{{pathParam}}", {{pathParamName}});
        throw new UnsupportedOperationException("JSON payload not supported for GET operations");
    }

    public {{returnType}} {{methodName}}(String {{pathParamName}}, {{paramsClassName}} params) throws ChargebeeException {
        Response response = {{methodName}}Raw({{pathParamName}}, params);
        return {{returnType}}.fromJson(response.getBodyAsString(), this, params, {{pathParamName}}, response);
    }

    public {{returnType}} {{methodName}}(String {{pathParamName}}) throws ChargebeeException {
        Response response = {{methodName}}Raw({{pathParamName}});
        return {{returnType}}.fromJson(response.getBodyAsString(), this, null, {{pathParamName}}, response);
    }

    {{else}}
    
    /**
     * {{methodName}} a {{../packageName}} (executes immediately) - returns raw Response.
     */
    Response {{methodName}}Raw(String {{pathParamName}}) throws ChargebeeException {
        String path = buildPathWithParams("{{path}}", "{{pathParam}}", {{pathParamName}});
        {{#if (eq httpMethod "post")}}
        return post(path, null);
        {{else}}
        return get(path, null);
        {{/if}}
    }

    {{#if (and (eq httpMethod "post") hasRequestBody)}}
    /**
     * {{methodName}} a {{../packageName}} using immutable params (executes immediately) - returns raw Response.
     */
    Response {{methodName}}Raw(String {{pathParamName}}, {{paramsClassName}} params) throws ChargebeeException {
        String path = buildPathWithParams("{{path}}", "{{pathParam}}", {{pathParamName}});
        return post(path, params.toFormData());
    }

    /**
     * {{methodName}} a {{../packageName}} using raw JSON payload (executes immediately) - returns raw Response.
     */
    Response {{methodName}}Raw(String {{pathParamName}}, String jsonPayload) throws ChargebeeException {
        String path = buildPathWithParams("{{path}}", "{{pathParam}}", {{pathParamName}});
        return postJson(path, jsonPayload);
    }

    public {{returnType}} {{methodName}}(String {{pathParamName}}, {{paramsClassName}} params) throws ChargebeeException {
        Response response = {{methodName}}Raw({{pathParamName}}, params);
        return {{returnType}}.fromJson(response.getBodyAsString(), response);
    }
    {{/if}}

    {{#if (and (eq httpMethod "get") hasQueryParams)}}
    /**
     * {{methodName}} a {{../packageName}} using immutable params (executes immediately) - returns raw Response.
     */
    Response {{methodName}}Raw(String {{pathParamName}}, {{paramsClassName}} params) throws ChargebeeException {
        String path = buildPathWithParams("{{path}}", "{{pathParam}}", {{pathParamName}});
        return get(path, params != null ? params.toQueryParams() : null);
    }

    public {{returnType}} {{methodName}}(String {{pathParamName}}, {{paramsClassName}} params) throws ChargebeeException {
        Response response = {{methodName}}Raw({{pathParamName}}, params);
        return {{returnType}}.fromJson(response.getBodyAsString(), response);
    }
    {{/if}}

    {{!-- Generate no-params method if: not a POST with body, OR all body params are optional --}}
    {{#if (or (not (and (eq httpMethod "post") hasRequestBody)) isAllRequestBodyParamsOptional)}}
    public {{returnType}} {{methodName}}(String {{pathParamName}}) throws ChargebeeException {
        Response response = {{methodName}}Raw({{pathParamName}});
        return {{returnType}}.fromJson(response.getBodyAsString(), response);
    }
    {{/if}}

    {{/if}}
    {{else}}
    
    /**
     * {{methodName}} a {{../packageName}} using immutable params (executes immediately) - returns raw Response.
     */
    Response {{methodName}}Raw({{paramsClassName}} params) throws ChargebeeException {
        {{#if (eq httpMethod "post")}}
        return post("{{path}}", params != null ? params.toFormData() : null);
        {{else}}
        return get("{{path}}", params != null ? params.toQueryParams() : null);
        {{/if}}
    }

    {{#if (or isListResponse isAllQueryParamsOptional)}}
    /**
     * {{methodName}} a {{../packageName}} without params (executes immediately) - returns raw Response.
     */
    Response {{methodName}}Raw() throws ChargebeeException {
        {{#if (eq httpMethod "post")}}
        return post("{{path}}", null);
        {{else}}
        return get("{{path}}", null);
        {{/if}}
    }
    {{/if}}

    /**
     * {{methodName}} a {{../packageName}} using raw JSON payload (executes immediately) - returns raw Response.
     */
    Response {{methodName}}Raw(String jsonPayload) throws ChargebeeException {
        {{#if (eq httpMethod "post")}}
        return postJson("{{path}}", jsonPayload);
        {{else}}
        throw new UnsupportedOperationException("JSON payload not supported for GET operations");
        {{/if}}
    }

    public {{returnType}} {{methodName}}({{paramsClassName}} params) throws ChargebeeException {
        Response response = {{methodName}}Raw(params);
        {{#if isListResponse}}
        return {{returnType}}.fromJson(response.getBodyAsString(), this, params, response);
        {{else}}
        return {{returnType}}.fromJson(response.getBodyAsString(), response);
        {{/if}}
    }

    {{#if (or isListResponse isAllQueryParamsOptional)}}
    public {{returnType}} {{methodName}}() throws ChargebeeException {
        Response response = {{methodName}}Raw();
        {{#if isListResponse}}
        return {{returnType}}.fromJson(response.getBodyAsString(), this, null, response);
        {{else}}
        return {{returnType}}.fromJson(response.getBodyAsString(), response);
        {{/if}}
    }
    {{/if}}

    {{/if}}
    {{/each}}
{{#if (eq name "Export")}}
    // === Export Utility Methods ===
    
    /**
     * Waits for an export operation to complete by polling its status.
     * Polls every 10 seconds (configurable via cb.java.export.sleep.millis system property).
     * 
     * @param export The export to wait for (must have a valid ID)
     * @return The completed Export object with COMPLETED or FAILED status
     * @throws ChargebeeException if API call fails during polling
     * @throws RuntimeException if export takes too long (over 50 polling attempts)
     * @throws InterruptedException if thread is interrupted while waiting
     */
    public com.chargebee.v4.models.export.Export waitForExportCompletion(
            com.chargebee.v4.models.export.Export export) 
            throws ChargebeeException, InterruptedException {
        int count = 0;
        int sleepTime = Integer.getInteger("cb.java.export.sleep.millis", 10000);
        com.chargebee.v4.models.export.Export currentExport = export;
        
        while (currentExport.getStatus() == com.chargebee.v4.models.export.Export.Status.IN_PROCESS) {
            if (count++ > 50) {
                throw new RuntimeException("Export is taking too long");
            }
            Thread.sleep(sleepTime);
            ExportRetrieveResponse response = retrieve(currentExport.getId());
            currentExport = response.getExport();
        }
        return currentExport;
    }
{{/if}}
}