/*
 * This file is auto-generated by Chargebee.
 * For more information on how to make changes to this file, please see the README.
 * Reach out to dx@chargebee.com for any questions.
 * Copyright 2025 Chargebee Inc.
 */

package com.chargebee.v4.internal;

import java.util.Map;

/**
 * Represents a single entry in a batch request.
 * Each entry contains parameters and an optional correlation ID for response tracking.
 */
public class BatchEntry {

    private final Map<String, Object> parameters;
    private final String correlationId;

    public BatchEntry(Map<String, Object> parameters, String correlationId) {
        this.parameters = parameters;
        this.correlationId = correlationId;
    }

    public Map<String, Object> getParameters() {
        return parameters;
    }

    public String getCorrelationId() {
        return correlationId;
    }

    /**
     * Serialize this entry to a JSON string.
     */
    String toJson() {
        StringBuilder sb = new StringBuilder();
        sb.append("{\"parameters\":");
        sb.append(mapToJson(parameters));
        if (correlationId != null) {
            sb.append(",\"").append(BatchConstants.CORRELATION_ID).append("\":\"");
            sb.append(escapeJson(correlationId));
            sb.append('"');
        }
        sb.append('}');
        return sb.toString();
    }

    @SuppressWarnings("unchecked")
    private static String mapToJson(Map<String, Object> map) {
        if (map == null || map.isEmpty()) {
            return "{}";
        }
        StringBuilder sb = new StringBuilder();
        sb.append('{');
        boolean first = true;
        for (Map.Entry<String, Object> entry : map.entrySet()) {
            if (!first) {
                sb.append(',');
            }
            first = false;
            sb.append('"').append(escapeJson(entry.getKey())).append("\":");
            Object value = entry.getValue();
            if (value == null) {
                sb.append("null");
            } else if (value instanceof String) {
                sb.append('"').append(escapeJson((String) value)).append('"');
            } else if (value instanceof Number || value instanceof Boolean) {
                sb.append(value);
            } else if (value instanceof Map) {
                sb.append(mapToJson((Map<String, Object>) value));
            } else {
                sb.append('"').append(escapeJson(value.toString())).append('"');
            }
        }
        sb.append('}');
        return sb.toString();
    }

    private static String escapeJson(String value) {
        if (value == null) {
            return "";
        }
        StringBuilder sb = new StringBuilder(value.length());
        for (int i = 0; i < value.length(); i++) {
            char c = value.charAt(i);
            switch (c) {
                case '"':
                    sb.append("\\\"");
                    break;
                case '\\':
                    sb.append("\\\\");
                    break;
                case '\n':
                    sb.append("\\n");
                    break;
                case '\r':
                    sb.append("\\r");
                    break;
                case '\t':
                    sb.append("\\t");
                    break;
                default:
                    sb.append(c);
            }
        }
        return sb.toString();
    }
}